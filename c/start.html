<!DOCTYPE html>
<html>
<head>
    <title>标题</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <meta name="robots" content="noindex,nofollow"/>
    <meta name="referrer" content="no-referrer"/>
    <link rel="stylesheet" href="fa.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="icon" href="9.png"/>
    <link rel="stylesheet" href="style.css"/>
    <style></style>
</head>
<body data-t="l" data-n="2" data-f="3">
<dialog id="password">
    <h1>输入密码</h1>
    <div><input type="password"/><button onclick="ep()">OK</button></div>
    <p><strong>提示：</strong>提示文本</p>
</dialog>
<div id="loader">
    <div><p>文本1</p><button onclick="fo()">跳过</button></div>
</div>
<div id="bigger">窗口过大</div>
<div id="smaller">窗口过小</div>
<nav>
    <div>
        <div>
            <button onclick="document.querySelector('nav>div:nth-of-type(2)').classList.toggle('active')" class="fa fa-navicon"></button>
            <button onclick="window.scrollTo(0,0)" class="fa fa-chevron-up"></button>
            <button onclick="showPage('HOME')" id="logo"></button>
            <button onclick="window.scrollTo(0,document.documentElement.scrollHeight)" class="fa fa-chevron-down"></button>
            <button onclick="document.getElementById('sD').showModal()" class="fa fa-gear"></button>
        </div>
        <div><input type="text" placeholder="搜索关键词" oninput="search()"/></div>
    </div>
    <div>
        <button onclick="showPage('START')">开始</button>
    </div>
</nav>
<div id="main">
    <dialog id="sD">
        <div>设置
            <button onclick="localStorage.clear();ubg();location.reload(true);">重置</button>
            <span onclick="document.getElementById('sD').close()" style="float:right;cursor:pointer;">×</span>
        </div>
        <div><span>主题</span>
             <input type="radio" name="t" onclick="chT('l')" style="--rc:'浅'">
             <input type="radio" name="t" onclick="chT('d')" style="--rc:'深'">
             <input type="radio" name="t" onclick="chT('b')" style="--rc:'蓝'">
             <input type="radio" name="t" onclick="chT('n')" style="--rc:'夜'"></div>
        <div><span>导航栏</span>
             <input type="radio" name="n" onclick="chN('1')" style="--rc:'经典'">
             <input type="radio" name="n" onclick="chN('2')" style="--rc:'胶囊'" checked></div>
        <div><span>内容过滤</span>
             <input type="radio" name="f" onclick="chF('0')" style="--rc:'无'">
             <input type="radio" name="f" onclick="chF('1')" style="--rc:'一'">
             <input type="radio" name="f" onclick="chF('2')" style="--rc:'二'">
             <input type="radio" name="f" onclick="chF('3')" style="--rc:'三'" checked></div>
        <div><span>背景图片</span>
             <button onclick="ubg()">清除</button>
             <button onclick="cbg()">上传</button>
             <div><span>透明度</span><input type="range" max="100" min="0" step="10" id="r1"/></div>
             <div><span>虚化</span><input type="range" max="30" min="0" step="3" id="r2"/></div></div>
    </dialog>
<main id="HOME">
    <div id="slide">
        <div>
            <h1>九班</h1>
            <p>记录九班的人文事件</p>
            <button onclick="showPage('START')">开始</button>
        </div>
    </div>
    <style>
        #HOME{
            min-height:200vh;
            #slide{
                background-image:url('9.png');
                background-position:-35% -100px;
                background-attachment:fixed!important;
                background-repeat:no-repeat;
                background-size:150%;
                position:fixed;
                width:100dvw;
                top:0;
                left:0;
                height:200vh;
                opacity:1;
                animation:slide forwards;
                animation-timeline:scroll(root y);
                >div{
                    left:0;
                    width:100%;
                    height:100%;
                    padding:50vh 20px;
                    background:radial-gradient(farthest-corner at 0% 50%,var(--color),transparent);
                    color:var(--background);
                    backdrop-filter:blur(3px);
                    >h1{
                        font-size:4.5rem;
                    }
                    >p{
                        margin:20px 5px;
                    }
                    >button{
                        background:var(--nav-bg);
                        border-radius:99px;
                        font-size:1.25rem;
                        padding:7px 70px 7px 20px;
                    }
                }
            }
            >h1{
                background:linear-gradient(to right,#ad5a1f88,#ad5a1f11);
                font-size:2rem;
                font-weight:bold;
                padding:10px 20px;
                border-radius:15px;
                opacity:0;
                transform:translateY(20px);
                animation:homeTitle forwards;
                animation-timeline:view(block);
                animation-range:entry 100% exit 0%;
            }
            >div{
                
            }
        }
        @keyframes slide{
            0%{opacity:1;}
            50%{opacity:0;}
            100%{opacity:0;}
        }
        @keyframes homeTitle{
          from{opacity:0;transform:translateX(20px);}
          to{opacity:1;transform:translateX(0);}
        }
    </style>
    <h1 class="home-title" style="margin-top:100vh">推荐</h1>
    <div style="">
        <h1>龙翔<sup>初一</sup></h1>
        <p>第一个科目：稍息立正，跨立立正！</p>
    </div>
    <div style="">
        <h1>刘老师<sup>英语</sup></h1>
        <p>第一个科目：稍息立正，跨立立正！</p>
    </div>
</main>
<main id="START">
<header style="--header:#0ff">
    <h1>开始</h1>
    <span>描述文本</span>
    <span>描述文本</span>
    <span>描述文本</span>
    <table>
        <tr>
            <td>标题</td>
            <td>描述文本</td>
        </tr>
        <tr>
            <td>标题</td>
            <td>描述文本</td>
        </tr>
    </table>
</header>
    <p>接下来，将会从零开始，回顾初中阶段的大小事物。</p>
    <h1 id="">开学</h1>
    <div class="division"></div>
    <h1 id="">集体的环境</h1>
    <div class="division"></div>
    <h1 id="">老师</h1>
    <div class="division"></div>
    <h1 id="">学生</h1>
    <div class="division"></div>
    <h1 id="">社会实践</h1>
    <div class="division"></div>
    <h1 id="">九班档案</h1>
    <div class="division"></div>
    <h1 id="">毕业</h1>
    <div class="division"></div>
    
</main>
<main id="EVENT"></main>
<footer><h1>页面到底了！</h1></footer>
</div>
<script>
//密码（abc）
function ep(){
    var e=document.querySelector("#password input").value;
    "123"===e?(localStorage.setItem("p","true"),document.getElementById("password").close()):document.querySelector("#password input").style.background="#f004";
}
//页面切换
function showPage(e){
    var l=document.querySelectorAll("main"),
        n=document.getElementById(e),
        o=document.querySelectorAll("nav>div:nth-of-type(2)>div"),
        t=document.querySelector("nav>div:nth-of-type(1)>div:nth-of-type(2)");
    l.forEach(e=>{e.style.display="none"});
    o.forEach(e=>{e.style.display="none"});
    n&&(n.style.display="block");
    t.style.display="EVENT"==e?"inline-block":"none";
    document.getElementById(e+"-l").style.display="block";
    window.scrollTo(0,0);
}
//关闭菜单
document.addEventListener("click", function(t){
    var e=document.querySelector("nav>div:nth-of-type(2)"),
        n=document.querySelector("nav>div:nth-of-type(1) button.fa-navicon");
    e.classList.contains("active")&&!e.contains(t.target)&&t.target!==n&&e.classList.remove("active");
});
document.querySelectorAll("nav>div:nth-of-type(2) a,nav>div:nth-of-type(2) button").forEach(t=>{
    t.addEventListener("click",function(){
        document.querySelector("nav>div:nth-of-type(2)").classList.remove("active");
    })
});
//关闭模态框
document.getElementById("sD").addEventListener("click",function(t){
    var e=this.getBoundingClientRect();
    (t.clientX<e.left||e.right<t.clientX||t.clientY<e.top||e.bottom<t.clientY)&&this.close();
});
//主题切换
function chT(e){document.body.setAttribute("data-t",e),localStorage.setItem("t",e);}
function chN(e){document.body.setAttribute("data-n",e),localStorage.setItem("n",e);}
function chF(e){document.body.setAttribute("data-tf",e),localStorage.setItem("f",e);search();}
document.getElementById('r1').addEventListener('input',function(){
    document.querySelector('body>#main').style.setProperty("--o",this.value);
    localStorage.setItem("o",this.value);
});
document.getElementById('r2').addEventListener('input',function(){
    document.querySelector('body>#main').style.backdropFilter="blur("+this.value+"px)";
    localStorage.setItem("b",this.value);
});
//背景图片
let db;
const request=indexedDB.open("bgDB",1);
function lbg(){
    const e=db.transaction(["bg"],"readonly").objectStore("bg").get(1);
    e.onsuccess=function(){e.result&&(document.body.style.backgroundImage=`url(${e.result.image})`)}
}
function cbg(){
    var e=document.createElement("input");
    e.type="file";
    e.accept="image/*";
    e.onchange=function(e){
        var t,e=e.target.files[0];
        e&&((t=new FileReader).onload=function(e){
            db.transaction(["bg"],"readwrite").objectStore("bg").put({id:1,image:e.target.result});
            document.body.style.backgroundImage=`url(${e.target.result})`;
        },t.readAsDataURL(e))
    }
    e.click();
}
function ubg(){
    db.transaction(["bg"],"readwrite").objectStore("bg").delete(1);
    document.body.style.backgroundImage="";
}
request.onupgradeneeded=function(e){(db=e.target.result).objectStoreNames.contains("bg")||db.createObjectStore("bg",{keyPath:"id"})};
request.onsuccess=function(e){db=e.target.result,lbg()};
//替代图像
document.querySelectorAll("img").forEach(m=>{m.onerror=function(){this.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiB2aWV3Qm94PSIwIDAgMzAwIDIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzhkZDQiLz48L3N2Zz4="}});
//日志页逻辑
function search(){
    var e=document.querySelector("nav input").value.trim(),
        t=document.getElementById("EVENT");
    if (t&&"none"!==window.getComputedStyle(t).display){
        if(t=t.querySelectorAll("p,dd"),e){
            const i=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");
            t.forEach(e=>{
                e.hasAttribute("data-or")||e.setAttribute("data-or",e.innerHTML);
                var t=e.getAttribute("data-or");
                i.test(t.replace(/<[^>]*>/g,""))?
                    (e.style.display="",
                     e.innerHTML=t.replace(/([^<]*)(<[^>]*>)?/g,(e,t,a)=>t?t.replace(i,e=>`<mark>${e}</mark>`)+(a||""):a||"")):
                e.style.display="none",i.lastIndex=0;
            })
        }else t.forEach(e=>{
            e.style.display="";
            e.hasAttribute("data-or")&&(e.innerHTML=e.getAttribute("data-or"),e.removeAttribute("data-or"));
        });
        heb();
    }
}
function hot(){
    const d=document.querySelector("nav>div:nth-of-type(1)>div:nth-of-type(2)>button").classList.contains('active');
    d?document.body.setAttribute("data-th","1"):document.body.setAttribute("data-th","2");
    console.log(document.body.getAttribute("data-th"));
    document.querySelector("nav>div:nth-of-type(1)>div:nth-of-type(2)>button").classList.toggle("active");
    heb();
}
function heb(){
    document.querySelectorAll("#EVENT>div").forEach(e=>{
        var t=Array.from(e.children).some(e=>"TIME"!==e.tagName&&"none"!==window.getComputedStyle(e).display);
        e.style.display=t?"":"none";});
    document.querySelectorAll("#EVENT dl").forEach(e=>{
        var t=Array.from(e.querySelectorAll("dd")).every(e=>"none"===window.getComputedStyle(e).display);
        e.style.display=t?"none":"";});
    document.querySelectorAll("#EVENT>h1").forEach(e=>{
        let t=e.nextElementSibling,l=!1;
        for(;t&&"H1"!==t.tagName;){"none"!==t.style.display&&(l=!0);t=t.nextElementSibling;}
        e.style.display=l?"":"none";
    });
}
heb();
const obs=new MutationObserver(heb);
obs.observe(document.getElementById("EVENT"),{
    childList:!0,
    subtree:!0,
    attributes:!0,
    attributeFilter:["style"]
});
//外部链接在新页面打开
document.querySelectorAll('a[href^="http"]').forEach(link=>{
    link.setAttribute('target','_blank');
    link.setAttribute('rel','noopener noreferrer');
});
//加载文字轮播
const texts=["文本1","文本2"];
let ci=0;
const ct=document.querySelector('#loader>div>p');
ct.textContent=texts[ci];
function rotateText(){
    ci=(ci+1)%texts.length;
    ct.style.opacity='0';
    setTimeout(()=>{ct.textContent=texts[ci];ct.style.opacity='1';},200);
}
setInterval(rotateText,1000);
//加载动画
function fo(){
    const t=document.getElementById("loader"),o=performance.now();
    let a;
    requestAnimationFrame(function e(n){
        n-=o;
        a=1-(n=Math.min(n/300,1));
        t.style.opacity=a;
        n<1?requestAnimationFrame(e):t.style.display="none";
    });
}
window.addEventListener("load",function(){setTimeout(fo,300);});
//初始化
window.addEventListener('DOMContentLoaded',function(){
    const p=localStorage.getItem('p');
    p?document.getElementById('password').close():document.getElementById('password').showModal();
    const t=localStorage.getItem('t');t&&(chT(t),document.querySelector(`input[name="t"][onclick*="${t}"]`).checked=!0);
    const n=localStorage.getItem('n');n&&(chN(n),document.querySelector(`input[name="n"][onclick*="${n}"]`).checked=!0);
    const f=localStorage.getItem('f');f&&(chF(f),document.querySelector(`input[name="f"][onclick*="${f}"]`).checked=!0);
    const o=localStorage.getItem('o');
    o&&(document.querySelector('body>#main').style.setProperty("--o",o),document.getElementById('r1').value=o);
    const b=localStorage.getItem('b');
    b&&(document.querySelector('body>#main').style.backdropFilter="blur("+b+"px)",document.getElementById('r2').value=b);
    showPage('HOME');
});
</script>
</body>
</html>