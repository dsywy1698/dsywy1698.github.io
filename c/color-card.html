<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>自定义配色卡</title>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style>
    :root {
      --bg-color: #f8f9fa;
      --text-color: #333;
      --primary-color: #6366f1;
      --secondary-color: #e5e7eb;
      --accent-color: #f59e0b;
      --danger-color: #ef4444;
      --success-color: #10b981;
      --modal-bg: rgba(0, 0, 0, 0.5);
      --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      padding-top: 80px;
      line-height: 1.5;
    }
    /* 顶部工具栏 */
    .toolbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content:center;
      padding: 0 20px;
      gap: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      z-index: 100;
    }
    .color-input {
      padding: 10px 15px;
      border: 1px solid var(--secondary-color);
      border-radius: 8px;
      font-size: 16px;
      transition: var(--transition);
      outline: none;
      max-width:200px;
    }
    .color-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
    }
    .btn {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      width:100px;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    .btn-primary:hover {
      background-color: #4f46e5;
    }
    .btn-secondary {
      background-color: var(--secondary-color);
      color: var(--text-color);
    }
    .btn-secondary:hover {
      background-color: #d1d5db;
    }
    .btn-danger {
      background-color: var(--danger-color);
      color: white;
    }
    .btn-danger:hover {
      background-color: #dc2626;
    }
    .btn-success {
      background-color: var(--success-color);
      color: white;
    }
    .btn-success:hover {
      background-color: #059669;
    }
    /* 主内容区 */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    /* 色卡区域 */
    .color-cards {
      display: flex;
      flex-wrap: wrap;
      justify-content:center;
      gap: 20px;
      margin-bottom: 40px;
    }
    .color-card {
      width: 150px;
      height: 150px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 15px;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }
    .color-card.selected {
      box-shadow: 0 0 0 3px var(--primary-color), 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .color-code {
      font-weight: 600;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    .color-name {
      font-size: 14px;
      text-align: center;
      opacity: 0.9;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    /* 分组区域 */
    .groups-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .color-group {
      border-radius: 12px;
      background-color: white;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      transition: var(--transition);
    }
    .group-header {
      padding: 15px 20px;
      background-color: #f3f4f6;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .group-header:hover {
      background-color: #e5e7eb;
    }
    .group-name {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .group-actions {
      display: flex;
      gap: 10px;
    }
    .group-action-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #6b7280;
      transition: var(--transition);
      padding: 5px;
      border-radius: 4px;
    }
    .group-action-btn:hover {
      color: var(--text-color);
      background-color: #e5e7eb;
    }
    .group-content {
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      min-height: 80px;
      justify-content:center;
    }
    .group-content.empty {
      justify-content: center;
      align-items: center;
      color: #6b7280;
      font-style: italic;
    }
    /* 模态框 */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--modal-bg);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background-color: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      padding: 25px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      transform: translateY(20px);
      transition: var(--transition);
    }
    .modal-overlay.active .modal {
      transform: translateY(0);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-title {
      font-size: 20px;
      font-weight: 600;
    }
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6b7280;
      transition: var(--transition);
    }
    .close-modal:hover {
      color: var(--text-color);
    }
    .modal-body {
      margin-bottom: 25px;
    }
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    /* 颜色信息模态框 */
    .color-info-modal .color-preview {
      width: 100%;
      height: 80px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .color-info-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    .color-info-label {
      font-weight: 500;
      color: #6b7280;
    }
    .color-info-value {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .copy-btn {
      background-color: #f3f4f6;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
      transition: var(--transition);
    }
    .copy-btn:hover {
      background-color: #e5e7eb;
    }
    .color-name-input {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid var(--secondary-color);
      border-radius: 8px;
      font-size: 16px;
      margin-top: 10px;
    }
    /* 新建分组模态框 */
    .group-form-group {
      margin-bottom: 20px;
    }
    .group-form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .group-form-input {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid var(--secondary-color);
      border-radius: 8px;
      font-size: 16px;
    }
    .initial-colors-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .initial-color-input {
      display: flex;
      gap: 10px;
    }
    .add-color-btn {
      background-color: #f3f4f6;
      border: 1px dashed #d1d5db;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .add-color-btn:hover {
      background-color: #e5e7eb;
    }
    /* 提示消息 */
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .toast {
      background-color: white;
      border-radius: 8px;
      padding: 12px 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    .toast.show {
      transform: translateX(0);
    }
    .toast-success {
      border-left: 4px solid var(--success-color);
    }
    .toast-error {
      border-left: 4px solid var(--danger-color);
    }
    .toast-icon {
      font-size: 20px;
    }
    .toast-success .toast-icon {
      color: var(--success-color);
    }
    .toast-error .toast-icon {
      color: var(--danger-color);
    }
    /* 响应式设计 */
    @media (max-width: 768px) {
      .color-card {
        width: calc(50% - 10px);
        height: 120px;
      }
      .modal {
        width: 95%;
        padding: 20px;
      }
    }
    @media (max-width: 480px) {
    .toolbar {
        flex-wrap: wrap;
        height: auto;
        padding: 10px;
        gap: 8px;
      }
      .color-input {
        width: 100%;
      }
      .btn {
        padding: 8px 12px;
        font-size: 14px;
      }
      body {
        padding-top: 120px;
      }
      .color-card {
        width: 100%;
      }
      .color-info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- 顶部工具栏 -->
  <div class="toolbar">
    <input type="text" class="color-input" id="colorInput" placeholder="颜色值" maxlength="7">
    <button class="btn btn-primary" id="createColorBtn">创建</button>
    <button class="btn btn-secondary" id="createGroupBtn">分组</button>
    <button class="btn btn-danger" id="deleteBtn">删除</button>
  </div>
  <!-- 主内容区 -->
  <div class="main-content">
    <!-- 未分组色卡区域 -->
    <div class="color-cards" id="ungroupedColors">
      <!-- 未分组的色卡将在这里显示 -->
    </div>
    <!-- 分组区域 -->
    <div class="groups-container" id="groupsContainer">
      <!-- 颜色分组将在这里显示 -->
    </div>
  </div>
  <!-- 颜色信息模态框 -->
  <div class="modal-overlay" id="colorInfoModal">
    <div class="modal color-info-modal">
      <div class="modal-header">
        <h3 class="modal-title">颜色信息</h3>
        <button class="close-modal" id="closeColorInfoModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="color-preview" id="modalColorPreview"></div>
        <div class="color-info-grid">
          <div class="color-info-label">HEX:</div>
          <div class="color-info-value">
            <span id="modalHexValue"></span>
            <button class="copy-btn" id="copyHexBtn">复制</button>
          </div>
          <div class="color-info-label">RGB:</div>
          <div class="color-info-value">
            <span id="modalRgbValue"></span>
            <button class="copy-btn" id="copyRgbBtn">复制</button>
          </div>
          <div class="color-info-label">HSL:</div>
          <div class="color-info-value">
            <span id="modalHslValue"></span>
            <button class="copy-btn" id="copyHslBtn">复制</button>
          </div>
        </div>
        <input type="text" class="color-name-input" id="modalColorNameInput" placeholder="颜色名">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelColorInfoBtn">取消</button>
        <button class="btn btn-primary" id="saveColorNameBtn">保存</button>
      </div>
    </div>
  </div>
  <!-- 新建分组模态框 -->
  <div class="modal-overlay" id="createGroupModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">新建分组</h3>
        <button class="close-modal" id="closeCreateGroupModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="group-form-group">
          <label class="group-form-label" for="groupNameInput">分组名称</label>
          <input type="text" class="group-form-input" id="groupNameInput" placeholder="名称" required>
        </div>
        <div class="group-form-group">
          <label class="group-form-label">初始颜色（可选）</label>
          <div class="initial-colors-container" id="initialColorsContainer">
            <div class="initial-color-input">
              <input type="text" class="group-form-input" placeholder="颜色值">
            </div>
          </div>
          <div class="add-color-btn" id="addInitialColorBtn">添加颜色</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelCreateGroupBtn">取消</button>
        <button class="btn btn-primary" id="confirmCreateGroupBtn">创建</button>
      </div>
    </div>
  </div>
  <!-- 编辑分组模态框 -->
  <div class="modal-overlay" id="editGroupModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">编辑分组</h3>
        <button class="close-modal" id="closeEditGroupModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="group-form-group">
          <label class="group-form-label" for="editGroupNameInput">分组名称</label>
          <input type="text" class="group-form-input" id="editGroupNameInput" placeholder="名称" required>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="deleteGroupBtn">分组</button>
        <button class="btn btn-secondary" id="cancelEditGroupBtn">取消</button>
        <button class="btn btn-primary" id="saveGroupNameBtn">保存</button>
      </div>
    </div>
  </div>
  <!-- 提示消息容器 -->
  <div class="toast-container" id="toastContainer"></div>
  <script>
    // 数据模型
    let colorCards = [];
    let colorGroups = [];
    let selectedColorIds = new Set();
    let isDeleteMode = false;
    let currentEditingColorId = null;
    let currentEditingGroupId = null;
    let draggedColorId = null;
    // DOM 元素
    const colorInput = document.getElementById('colorInput');
    const createColorBtn = document.getElementById('createColorBtn');
    const createGroupBtn = document.getElementById('createGroupBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const ungroupedColorsContainer = document.getElementById('ungroupedColors');
    const groupsContainer = document.getElementById('groupsContainer');
    const colorInfoModal = document.getElementById('colorInfoModal');
    const closeColorInfoModal = document.getElementById('closeColorInfoModal');
    const modalColorPreview = document.getElementById('modalColorPreview');
    const modalHexValue = document.getElementById('modalHexValue');
    const modalRgbValue = document.getElementById('modalRgbValue');
    const modalHslValue = document.getElementById('modalHslValue');
    const copyHexBtn = document.getElementById('copyHexBtn');
    const copyRgbBtn = document.getElementById('copyRgbBtn');
    const copyHslBtn = document.getElementById('copyHslBtn');
    const modalColorNameInput = document.getElementById('modalColorNameInput');
    const cancelColorInfoBtn = document.getElementById('cancelColorInfoBtn');
    const saveColorNameBtn = document.getElementById('saveColorNameBtn');
    const createGroupModal = document.getElementById('createGroupModal');
    const closeCreateGroupModal = document.getElementById('closeCreateGroupModal');
    const groupNameInput = document.getElementById('groupNameInput');
    const initialColorsContainer = document.getElementById('initialColorsContainer');
    const addInitialColorBtn = document.getElementById('addInitialColorBtn');
    const cancelCreateGroupBtn = document.getElementById('cancelCreateGroupBtn');
    const confirmCreateGroupBtn = document.getElementById('confirmCreateGroupBtn');
    const editGroupModal = document.getElementById('editGroupModal');
    const closeEditGroupModal = document.getElementById('closeEditGroupModal');
    const editGroupNameInput = document.getElementById('editGroupNameInput');
    const deleteGroupBtn = document.getElementById('deleteGroupBtn');
    const cancelEditGroupBtn = document.getElementById('cancelEditGroupBtn');
    const saveGroupNameBtn = document.getElementById('saveGroupNameBtn');
    const toastContainer = document.getElementById('toastContainer');
    // 初始化
    function init() {
      loadData();
      renderColorCards();
      renderColorGroups();
      setupEventListeners();
    }
    // 加载数据
    function loadData() {
      const savedColors = localStorage.getItem('colorCards');
      const savedGroups = localStorage.getItem('colorGroups');
      
      if (savedColors) {
        colorCards = JSON.parse(savedColors);
      }
      
      if (savedGroups) {
        colorGroups = JSON.parse(savedGroups);
      }
    }
    // 保存数据
    function saveData() {
      localStorage.setItem('colorCards', JSON.stringify(colorCards));
      localStorage.setItem('colorGroups', JSON.stringify(colorGroups));
    }
    // 渲染未分组色卡
    function renderColorCards() {
      ungroupedColorsContainer.innerHTML = '';
      const ungroupedColors = colorCards.filter(card => !card.groupId);
      if (ungroupedColors.length === 0) {
        ungroupedColorsContainer.innerHTML = '<div class="empty-state"></div>';
        return;
      }
      ungroupedColors.forEach(card => {
        const colorCard = createColorCardElement(card);
        ungroupedColorsContainer.appendChild(colorCard);
      });
    }
    // 渲染颜色分组
    function renderColorGroups() {
      groupsContainer.innerHTML = '';
      colorGroups.forEach(group => {
        const groupElement = document.createElement('div');
        groupElement.className = 'color-group';
        groupElement.dataset.groupId = group.id;
        const groupHeader = document.createElement('div');
        groupHeader.className = 'group-header';
        groupHeader.innerHTML = `
          <div class="group-name">
            <i class="fa fa-folder-o"></i>
            <span>${group.name}</span>
          </div>
          <div class="group-actions">
            <button class="group-action-btn edit-group-btn" data-group-id="${group.id}">
              <i class="fa fa-pencil"></i>
            </button>
            <button class="group-action-btn export-group-btn" data-group-id="${group.id}">
              <i class="fa fa-download"></i>
            </button>
          </div>
        `;
        const groupContent = document.createElement('div');
        groupContent.className = 'group-content';
        groupContent.dataset.groupId = group.id;
        // 获取分组内的所有色卡
        const groupColors = colorCards.filter(card => card.groupId === group.id);
        if (groupColors.length === 0) {
          groupContent.className = 'group-content empty';
          groupContent.innerHTML = '拖拽色卡到此处';
        } else {
          groupColors.forEach(card => {
            const colorCard = createColorCardElement(card);
            groupContent.appendChild(colorCard);
          });
        }
        groupElement.appendChild(groupHeader);
        groupElement.appendChild(groupContent);
        groupsContainer.appendChild(groupElement);
        // 添加拖拽事件
        setupDragAndDrop(groupContent);
      });
    }
    // 创建色卡元素
    function createColorCardElement(card) {
      const colorCard = document.createElement('div');
      colorCard.className = `color-card ${selectedColorIds.has(card.id) ? 'selected' : ''}`;
      colorCard.dataset.colorId = card.id;
      colorCard.style.backgroundColor = card.color;
      const textColor = getContrastColor(card.color);
      colorCard.style.color = textColor;
      colorCard.innerHTML = `
        <div class="color-name">${card.name || '色卡'}</div>
        <div class="color-code">${card.color}</div>
      `;
      // 添加点击事件
      colorCard.addEventListener('click', () => handleColorCardClick(card.id));
      // 添加拖拽属性
      colorCard.draggable = true;
      colorCard.addEventListener('dragstart', (e) => {
        draggedColorId = card.id;
        e.dataTransfer.setData('text/plain', card.id);
      });
      return colorCard;
    }
    // 设置事件监听器
    function setupEventListeners() {
      // 创建颜色按钮
      createColorBtn.addEventListener('click', createColorCard);
      // 颜色输入框回车事件
      colorInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          createColorCard();
        }
      });
      // 新建分组按钮
      createGroupBtn.addEventListener('click', () => {
        createGroupModal.classList.add('active');
        groupNameInput.focus();
      });
      // 删除按钮
      deleteBtn.addEventListener('click', toggleDeleteMode);
      // 颜色信息模态框
      closeColorInfoModal.addEventListener('click', () => colorInfoModal.classList.remove('active'));
      cancelColorInfoBtn.addEventListener('click', () => colorInfoModal.classList.remove('active'));
      saveColorNameBtn.addEventListener('click', saveColorName);
      // 复制按钮
      copyHexBtn.addEventListener('click', () => copyToClipboard(modalHexValue.textContent));
      copyRgbBtn.addEventListener('click', () => copyToClipboard(modalRgbValue.textContent));
      copyHslBtn.addEventListener('click', () => copyToClipboard(modalHslValue.textContent));
      // 新建分组模态框
      closeCreateGroupModal.addEventListener('click', () => createGroupModal.classList.remove('active'));
      cancelCreateGroupBtn.addEventListener('click', () => createGroupModal.classList.remove('active'));
      confirmCreateGroupBtn.addEventListener('click', createColorGroup);
      addInitialColorBtn.addEventListener('click', addInitialColorInput);
      // 编辑分组模态框
      closeEditGroupModal.addEventListener('click', () => editGroupModal.classList.remove('active'));
      cancelEditGroupBtn.addEventListener('click', () => editGroupModal.classList.remove('active'));
      saveGroupNameBtn.addEventListener('click', saveGroupName);
      deleteGroupBtn.addEventListener('click', deleteColorGroup);
      // 点击模态框外部关闭
      window.addEventListener('click', (e) => {
        if (e.target === colorInfoModal) {
          colorInfoModal.classList.remove('active');
        }
        if (e.target === createGroupModal) {
          createGroupModal.classList.remove('active');
        }
        if (e.target === editGroupModal) {
          editGroupModal.classList.remove('active');
        }
      });
      // 编辑分组按钮、导出按钮和分组标题点击事件委托
      groupsContainer.addEventListener('click', (e) => {
        // 点击铅笔图标图标编辑按钮
        if (e.target.closest('.edit-group-btn')) {
          const groupId = e.target.closest('.edit-group-btn').dataset.groupId;
          openEditGroupModal(groupId);
        }
        // 点击导出按钮
        else if (e.target.closest('.export-group-btn')) {
          const groupId = e.target.closest('.export-group-btn').dataset.groupId;
          exportGroupColors(groupId);
        }
        // 点击分组标题（不包括操作按钮区域）
        else if (e.target.closest('.group-header') && !e.target.closest('.group-actions')) {
          const groupHeader = e.target.closest('.group-header');
          const groupElement = groupHeader.parentElement;
          const groupId = groupElement.dataset.groupId;
          openEditGroupModal(groupId);
        }
      });
    }
    // 设置拖拽功能
    function setupDragAndDrop(container) {
      container.addEventListener('dragover', (e) => {
        e.preventDefault();
        container.classList.add('drag-over');
      });
      container.addEventListener('dragleave', () => {
        container.classList.remove('drag-over');
      });
      container.addEventListener('drop', (e) => {
        e.preventDefault();
        container.classList.remove('drag-over');
        if (draggedColorId) {
          const groupId = container.dataset.groupId;
          moveColorToGroup(draggedColorId, groupId);
          draggedColorId = null;
        }
      });
    }
    // 创建色卡
    function createColorCard() {
      const colorValue = colorInput.value.trim();
      // 预处理颜色值，移除可能的空格并转为小写
      const processedColor = colorValue.trim().toLowerCase();
      if (!isValidHexColor(processedColor)) {
        showToast('请输入有效的16进制颜色值', 'error');
        return;
      }
      const normalizedColor = normalizeHexColor(colorValue);
      const newCard = {
        id: generateUniqueId(),
        color: normalizedColor,
        name: '',
        groupId: null,
        createdAt: new Date().toISOString()
      };
      colorCards.push(newCard);
      saveData();
      renderColorCards();
      colorInput.value = '';
      showToast('色卡创建成功', 'success');
      // 自动打开颜色信息模态框
      setTimeout(() => {
        openColorInfoModal(newCard.id);
      }, 300);
    }
    // 处理色卡点击
    function handleColorCardClick(colorId) {
      if (isDeleteMode) {
        toggleColorSelection(colorId);
      } else {
        openColorInfoModal(colorId);
      }
    }
    // 切换删除模式
    function toggleDeleteMode() {
      isDeleteMode = !isDeleteMode;
      if (isDeleteMode) {
        deleteBtn.textContent = '确认删除';
        deleteBtn.classList.add('active');
        selectedColorIds.clear();
      } else {
        if (selectedColorIds.size > 0) {
          deleteSelectedColors();
        }
        deleteBtn.textContent = '删除';
        deleteBtn.classList.remove('active');
      }
      renderColorCards();
      renderColorGroups();
    }
    // 切换色卡选择状态
    function toggleColorSelection(colorId) {
      if (selectedColorIds.has(colorId)) {
        selectedColorIds.delete(colorId);
      } else {
        selectedColorIds.add(colorId);
      }
      renderColorCards();
      renderColorGroups();
    }
    // 删除选中的色卡
    function deleteSelectedColors() {
      if (selectedColorIds.size === 0) return;
      colorCards = colorCards.filter(card => !selectedColorIds.has(card.id));
      selectedColorIds.clear();
      saveData();
      renderColorCards();
      renderColorGroups();
      showToast('已删除选中的色卡', 'success');
    }
    // 打开颜色信息模态框
    function openColorInfoModal(colorId) {
      const colorCard = colorCards.find(card => card.id === colorId);
      if (!colorCard) return;
      currentEditingColorId = colorId;
      modalColorPreview.style.backgroundColor = colorCard.color;
      modalHexValue.textContent = colorCard.color;
      const rgb = hexToRgb(colorCard.color);
      modalRgbValue.textContent = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
      const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
      modalHslValue.textContent = `hsl(${Math.round(hsl.h)}, ${Math.round(hsl.s)}%, ${Math.round(hsl.l)}%)`;
      modalColorNameInput.value = colorCard.name || '';
      colorInfoModal.classList.add('active');
      modalColorNameInput.focus();
    }
    // 保存颜色名称
    function saveColorName() {
      if (!currentEditingColorId) return;
      const colorCard = colorCards.find(card => card.id === currentEditingColorId);
      if (colorCard) {
        colorCard.name = modalColorNameInput.value.trim();
        saveData();
        renderColorCards();
        renderColorGroups();
        colorInfoModal.classList.remove('active');
        showToast('颜色名称已保存', 'success');
      }
    }
    // 创建颜色分组
    function createColorGroup() {
      const groupName = groupNameInput.value.trim();
      if (!groupName) {
        showToast('请输入分组名称', 'error');
        return;
      }
      const newGroup = {
        id: generateUniqueId(),
        name: groupName,
        createdAt: new Date().toISOString()
      };
      colorGroups.push(newGroup);
      // 添加初始颜色
      const initialColorInputs = initialColorsContainer.querySelectorAll('input');
      const validColors = [];
      initialColorInputs.forEach(input => {
        const colorValue = input.value.trim().toLowerCase();
        if (isValidHexColor(colorValue)) {
          validColors.push(normalizeHexColor(colorValue));
        }
      });
      if (validColors.length > 0) {
        const newCards = validColors.map(color => ({
          id: generateUniqueId(),
          color: color,
          name: '',
          groupId: newGroup.id,
          createdAt: new Date().toISOString()
        }));
        colorCards.push(...newCards);
      }
      saveData();
      renderColorGroups();
      // 重置表单
      groupNameInput.value = '';
      initialColorsContainer.innerHTML = `
        <div class="initial-color-input">
          <input type="text" class="group-form-input" placeholder="颜色值">
        </div>
      `;
      createGroupModal.classList.remove('active');
      showToast('分组创建成功', 'success');
    }
    // 添加初始颜色输入框
    function addInitialColorInput() {
      const inputContainer = document.createElement('div');
      inputContainer.className = 'initial-color-input';
      inputContainer.innerHTML = `
        <input type="text" class="group-form-input" placeholder="#RRGGBB 或 RRGGBB">
      `;
      initialColorsContainer.appendChild(inputContainer);
      inputContainer.querySelector('input').focus();
    }
    // 打开编辑分组模态框
    function openEditGroupModal(groupId) {
      const group = colorGroups.find(g => g.id === groupId);
      if (!group) return;
      currentEditingGroupId = groupId;
      editGroupNameInput.value = group.name;
      editGroupModal.classList.add('active');
      editGroupNameInput.focus();
    }
    // 保存分组名称
    function saveGroupName() {
      if (!currentEditingGroupId) return;
      const groupName = editGroupNameInput.value.trim();
      if (!groupName) {
        showToast('请输入分组名称', 'error');
        return;
      }
      const group = colorGroups.find(g => g.id === currentEditingGroupId);
      if (group) {
        group.name = groupName;
        saveData();
        renderColorGroups();
        editGroupModal.classList.remove('active');
        showToast('分组名称已保存', 'success');
      }
    }
    // 删除颜色分组
    function deleteColorGroup() {
      if (!currentEditingGroupId) return;
      if (confirm('确定要删除这个分组吗？分组内的所有色卡也将被删除。')) {
        // 删除分组内的所有色卡
        colorCards = colorCards.filter(card => card.groupId !== currentEditingGroupId);
        // 删除分组
        colorGroups = colorGroups.filter(group => group.id !== currentEditingGroupId);
        saveData();
        renderColorCards();
        renderColorGroups();
        editGroupModal.classList.remove('active');
        showToast('分组已删除', 'success');
      }
    }
    // 移动色卡到分组
    function moveColorToGroup(colorId, groupId) {
      const colorCard = colorCards.find(card => card.id === colorId);
      if (colorCard) {
        colorCard.groupId = groupId;
        saveData();
        renderColorCards();
        renderColorGroups();
        const groupName = colorGroups.find(g => g.id === groupId)?.name || '分组';
        showToast(`色卡已移动到${groupName}`, 'success');
      }
    }
    // 复制到剪贴板
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text)
        .then(() => {
          showToast('已复制到剪贴板', 'success');
        })
        .catch(() => {
          showToast('复制失败，请手动复制', 'error');
        });
    }
    // 显示提示消息
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      const icon = document.createElement('div');
      icon.className = 'toast-icon';
      icon.innerHTML = type === 'success' ? '<i class="fa fa-check-circle"></i>' : '<i class="fa fa-exclamation-circle"></i>';
      const text = document.createElement('div');
      text.className = 'toast-text';
      text.textContent = message;
      toast.appendChild(icon);
      toast.appendChild(text);
      toastContainer.appendChild(toast);
      // 显示提示
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);
      // 自动隐藏
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          toastContainer.removeChild(toast);
        }, 300);
      }, 3000);
    }
    // 工具函数：生成唯一ID
    function generateUniqueId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
    }
    // 工具函数：验证16进制颜色
    function isValidHexColor(color) {
      // 允许带#号的6位或3位颜色值，或不带#号的6位或3位颜色值
      return /^(#[A-Fa-f0-9]{6}|#[A-Fa-f0-9]{3}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color);
    }
    // 工具函数：规范化16进制颜色
    function normalizeHexColor(color) {
      // 如果颜色值不带#号，添加#号
      if (!color.startsWith('#')) {
        color = '#' + color;
      }
      // 如果是3位颜色，扩展为6位
      if (color.length === 4) {
        return '#' + color[1] + color[1] + color[2] + color[2] + color[3] + color[3];
      }
      return color;
    }
    // 工具函数：获取对比度颜色
    function getContrastColor(hexColor) {
      const rgb = hexToRgb(hexColor);
      const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
      return brightness > 128 ? '#000000' : '#ffffff';
    }
    // 工具函数：16进制转RGB
    function hexToRgb(hex) {
      // 移除#号
      hex = hex.replace(/^#/, '');
      // 解析RGB值
      const bigint = parseInt(hex, 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return { r, g, b };
    }
    // 工具函数：RGB转HSL
    function rgbToHsl(r, g, b) {
      r /= 255;
      g /= 255;
      b /= 255;
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      if (max === min) {
        h = s = 0; // 灰色
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return { h: h * 360, s: s * 100, l: l * 100 };
    }
    // 导出分组颜色为HTML文件
    function exportGroupColors(groupId) {
      // 获取分组信息
      const group = colorGroups.find(g => g.id === groupId);
      if (!group) return;
      // 获取分组内的所有色卡
      const groupColors = colorCards.filter(card => card.groupId === groupId);
      if (groupColors.length === 0) {
        showToast('该分组没有可导出的色卡', 'error');
        return;
      }
      // 生成HTML内容
      let htmlContent = '<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>色卡-' + group.name + '</title><style>body{margin:0;padding:20px;font-family:Arial,sans-serif;background-color:#f8f9fa;}.color-cards{display:flex;flex-wrap:wrap;gap:15px;justify-content:center;}.color-card{width:120px;height:120px;border-radius:8px;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:10px;}.color-name{font-size:14px;margin-bottom:5px;text-align:center;}.color-code{font-size:12px;font-weight:bold;text-align:center;}</style></head><body><div class="color-cards">';
      // 添加所有色卡
      groupColors.forEach(card => {
        const textColor = getContrastColor(card.color);
        htmlContent += '<div class="color-card" style="background-color:' + card.color + ';color:' + textColor + ';"><div class="color-name">' + (card.name || '色卡') + '</div><div class="color-code">' + card.color + '</div></div>';
      });
      htmlContent += '</div></body></html>';
      // 创建Blob对象
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      // 创建下载链接
      const a = document.createElement('a');
      a.href = url;
      a.download = '色卡-' + group.name.replace(/\s+/g, '-').toLowerCase() + '.html';
      // 触发下载
      document.body.appendChild(a);
      a.click();
      // 清理
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
      showToast('分组色卡已导出', 'success');
    }
    // 初始化应用
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>